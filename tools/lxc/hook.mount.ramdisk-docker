#!/bin/sh

if [ -z "${LXC_NAME}" -o -z "${LXC_ROOTFS_MOUNT}" ]; then
	echo "This hook must be ran by lxc-start"
	exit 1
fi

# flush existing data directory if any
rm -rf ${LXC_ROOTFS_MOUNT}/var/lib/docker
mkdir -p ${LXC_ROOTFS_MOUNT}/var/lib/docker

# create ramdisk
mkdir -p /dev/shm/${LXC_NAME}/docker

# bind ramdisk with docker data directory
mount -n --bind /dev/shm/${LXC_NAME}/docker ${LXC_ROOTFS_MOUNT}/var/lib/docker
